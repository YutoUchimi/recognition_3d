<launch>
  <arg name="INPUT_RGB" default="/left_hand_camera/left/rgb/image_rect_color"/>
  <arg name="INPUT_DEPTH" default="/left_hand_camera/fused/depth_registered/points"/>
  <arg name="INPUT_INFO" default="/left_hand_camera/left/rgb/camera_info"/>
  <arg name="NODELET_MANAGER" default="/left_hand_camera/left/left_nodelet_manager"/>

  <group ns="/left_hand_camera">
    <node name="segment_objects"
          pkg="opencv_apps" type="segment_objects">
      <remap from="image" to="$(arg INPUT_RGB)"/>
      <rosparam>
        use_camera_info: false
        debeg_view: true
      </rosparam>
    </node>
    <node name="contour_array_to_mask"
          pkg="recognition_3d" type="contour_array_to_mask">
      <remap from="~input" to="segment_objects/image"/>
    </node>
    <node name="apply_mask_to_depth"
          pkg="recognition_3d" type="apply_mask_to_depth">
      <remap from="~input" to="$(arg INPUT_DEPTH)"/>
      <remap from="~input/mask" to="contour_array_to_mask/output"/>
    </node>
    <node name="kinfu"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/Kinfu $(arg NODELET_MANAGER)">
      <remap from="~input/camera_info" to="$(arg INPUT_INFO)"/>
      <remap from="~input/depth" to="apply_mask_to_depth/output"/>
      <remap from="~input/color" to="$(arg INPUT_RGB)"/>
      <rosparam>
        integrate_color: true
        queue_size: 10
        n_textures: -1
      </rosparam>
    </node>
    <node name="mask_fusion"
          pkg="recognition_3d" type="mask_fusion">
      <remap from="~input" to="contour_array_to_mask/output"/>
      <remap from="~input/info" to="$(arg INPUT_INFO)"/>
    </node>
    <node name="fuse_depth_images"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/FuseDepthImages $(arg NODELET_MANAGER)">
      <rosparam>
        input_topics:
          - kinfu/output/depth
          - mask_fusion/output/depth
        approximate_sync: true
        queue_size: 100
        averaging: false
      </rosparam>
    </node>
    <node name="point_cloud_xyzrgb"
          pkg="depth_image_proc" type="point_cloud_xyzrgb">
      <remap from="rgb/camera_info" to="$(arg INPUT_INFO)"/>
      <remap from="rgb/image_rect_color" to="$(arg INPUT_RGB)"/>
      <remap from="depth_registered/image_rect" to="fuse_depth_images/output"/>
      <rosparam>
        queue_size: 10
      </rosparam>
    </node>
  </group>

</launch>
